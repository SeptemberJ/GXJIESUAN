<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>修改</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/style.css" rel="stylesheet" />
		<script src="../../js/jquery-3.3.1.min.js"></script>
		<style>
			html , body{
				background: #fff;
			}
			.FloatRight{
				float: right;
				color: #dd524d;
				font-weight: bold;
			}
			#addOneWage{
				height: 30px;
				margin-top: 10px;
				margin-right: 10px;
			}
			.delete{
				color: #dd524d;
				font-weight: bold;
			}
			.mui-content{
				background: #fff !important;
			}
			.TextAlign_left{
				text-align: left;
			}
			.Margin_10{
				margin: 10px;
			}
			.ColumnBar{
				margin-top: 50px;
				padding-top: 10px;
				padding-bottom: 10px;
				border-top: 0px solid #efefef;
				border-bottom: 0px solid #efefef;
				font-size: 12px;
				font-weight: bold;
				text-align: center;
			}
			.ColumnBar_T{
				padding-top: 10px;
				padding-bottom: 10px;
				border-top: 0px solid #efefef;
				border-bottom: 0px solid #efefef;
				font-size: 12px;
				font-weight: bold;
				text-align: center;
			}
			.ColumnBar_B{
				padding-top: 10px;
				padding-bottom: 10px;
				border-top: 0px solid #efefef;
				border-bottom: 1px solid #efefef;
				font-size: 12px;
				font-weight: bold;
				text-align: center;
			}
			.employee_wage{
				text-align: center !important;
			}
			input{
				width: 100%;
				padding: 0 !important;
				font-size: 12px;
				border-radius: 0 !important;
				border: 0px !important;
				border-bottom: 1px solid #333 !important;
			}
			.ColumnBar input{
				text-align: left !important;
			}
			select{
				width: 100% !important;
				font-size: 12px;
				padding: 0;
				margin-top: 0;
				-webkit-appearance: menulist;
			    box-sizing: border-box;
			    align-items: center;
			    white-space: pre;
			    -webkit-rtl-ordering: logical;
			    color: black;
			    background-color: white;
			    cursor: default;
			    border-width: 1px;
			    border-style: solid;
			    border-color: initial;
			    border-image: initial;
			}
			.recordItem{
				padding: 0 10px;
				height: 40px;
				line-height: 40px;
				font-size: 12px;
				font-weight: normal;
			}
			.record{
				width: 100%;
				display: block;
				overflow: hidden;
			}
			.content_employee .record{
				padding: 0 8px;
				
			}
			.mui-table-view:before{
				height: 0px;
			}
			.mui-btn, button, input[type=button], input[type=reset], input[type=submit]{
				padding: 6px !important;
			}
		</style>
	</head>

	<body>
		<div class="mui-content" style="width:100%;height:50px;line-height:50px;background:'#fff';position: fixed;top: 0px;right: 0;z-index:999; box-shadow: 0px 2px 2px #888888;">
		    <div class="mui-row">
		    	<div class="mui-col-xs-6 ">
		    		 <span style="font-size: 12px;margin-left: 10px;" onclick="LookLog()">查看日志</span>
		    	</div>
		        <div class="mui-col-xs-6 ">
		        	<span id="addOneWage" class="mui-icon mui-icon-plus FloatRight"></span>
		        </div>
		    </div>
		</div>
		<div class="mui-content">
		    <div class="mui-row ColumnBar">
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		            	单号
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        		数量
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		            	工序
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		            	单价
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		            	工资额
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		            	
		        </div>
		    </div>
		</div>
		<!--列表1-->
		<div class="mui-content">
		    <div class="mui-row ColumnBar_T">
				<form name="wage" method="post">
					<div class="mui-content">
					    <div class="mui-row">
					        <ul id="content" class="mui-table-view">
					        </ul>
					    </div>
					</div>
					<div class="mui-content">
					    <div class="mui-row">
					        <ul class="mui-table-view">
					        	<li>
					        		<div class="mui-row  recordItem TextAlign_Left">
						        		<div class="mui-col-sm-6 mui-col-xs-6 ">
									            <span>合计</span>
									    </div>
						        		<div class="mui-col-sm-6 mui-col-xs-6 TextAlign_Right ColorRed">
									            ¥<output name="sum_T" class="sum_T">00.00</output>
									    </div>
								    </div>
					        	</li>
					        </ul>
					    </div>
					</div>
					
				</form>
			</div
		</div>
		<div class="mui-content">
		    <div class="mui-row ColumnBar_B">
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            	姓名
		        </div>
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		        		工资
		        </div>
		    </div>
		</div>
		 <!--列表2-->
		 <form name="employee">
			<div class="mui-content">
			    <div class="mui-row">
			        <ul id="content_employee" class="mui-table-view">
			        	
			        </ul>
			    </div>
			</div>
			<div class="mui-content">
			    <div class="mui-row">
			        <ul class="mui-table-view">
			        	<li>
			        		<div class="mui-row  recordItem">
				        		<div class="mui-col-sm-6 mui-col-xs-6 ">
							            <span>合计</span>
							    </div>
				        		<div class="mui-col-sm-6 mui-col-xs-6 TextAlign_Right ColorRed">
							            ¥<output name="sum_B" class="sum_B ">00.00</output>
							    </div>
						    </div>
			        	</li>
			        </ul>
			    </div>
			</div>
			
		</form>
		<div class="mui-content-padded">
			<button id='save' class="mui-btn mui-btn-block mui-btn-primary">保存</button>
		</div>
		
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/utils.js"></script>
		<script type="text/javascript">
			mui.init()
			var mask = mui.createMask();
			var LimitType = ''
			var GongXuListHtml = '';
			var employeeHtml = '';
			var GongxuMathList = []
			var Summary_T = 0.00
			var Summary_B = 0.00
			var BtIfCanSave = true
			var DATA =[]
			var salaryEmployee = []
			var addOneWage = document.getElementById('addOneWage');
			var wageForm = document.forms.wage,
				priceShow = document.getElementsByClassName('priceShow'),
				acreageFields = document.getElementsByClassName('acreage'),
				algorithmFields = document.getElementsByClassName('algorithm'),
		        totalFields = document.getElementsByClassName('item_total'),
		        deleteFields = document.getElementsByClassName('delete');
		        employeeWageFields = document.getElementsByClassName('employee_wage');
			var qtyListeners = function() {
		      var i = 0,
		          ln = algorithmFields.length;
		      for(;i<ln;i++) {
		      	acreageFields[i].addEventListener('input',calculateTotals, false);
		      	acreageFields[i].addEventListener('keyup',calculateTotals, false);
		      }
		    };
		    
			//根据工序id返回select选项
		    var CalculateAlgorithmPrice =  function(GongXuId){
		    	var ChoosedPrice = 0
		    	GongxuMathList.map(function(Item,Idx){
		    		if(Item.id == GongXuId){
		    			ChoosedPrice = parseFloat(Item.gongxu_price).toFixed(2)
		    		}
		    	})
		    	return ChoosedPrice
		    };
		    var CalculateAlgorithmValue =  function(GongXuId){
		    	var ChoosedValue = 0
		    	GongxuMathList.map(function(Item,Idx){
		    		if(Item.id == GongXuId){
		    			ChoosedValue = Idx
		    		}
		    	})
		    	return ChoosedValue
		    };
			
			var GetGongXu = function(){
				//新增时option string html
                mui.get(Url + 'gongxuMath?fdepartId='+window.localStorage.getItem('departmentId'),{},function(data){
						GongxuMathList = data.gongxuMathList,
						data.gongxuMathList.map(function(Item,Idx){
		            		GongXuListHtml += '<option  value='+ Item.gongxu_price+' data-algorithmid='+ Item.id +'>'+ Item.gongxu_name+ '</option>'
		            	})
					},'json'
				);
				//渲染返回option string html
				var GetSelectHtml = function(Price){
					var SelectHtml = ''
					GongxuMathList.map(function(Item,Idx){
						SelectHtml += '<option data-algorithmid='+ Item.id +'  value="'+ Item.gongxu_price +'"'+ (Item.gongxu_price == Price?"selected":"") +' >'+ Item.gongxu_name+ '</option>'

					})
					return (SelectHtml)
				}
			
				//渲染
				mui.get(Url + 'gongxu',{fdate:window.localStorage.getItem('recordDate'),id:window.localStorage.getItem('recordId')},function(data){
						$('.sum_T')[0].innerHTML = (data.salary.GxSalary).toFixed(2)
						$('.sum_B')[0].innerHTML = (data.salary.EmployeeSalary).toFixed(2)
						salaryEmployee = data.salary.salaryEmployeeList
						LimitType = data.salary.DiffDate
						//上半部分
						var NewHtml = ''
						data.salary.salarySqareList.map(function(Item,Idx){
							var Obj = {
								'fnumber': Item.fnumber,
								'sqare':Item.sqare,
								'price':0,
								'famount':Item.famount,
								'del': false
							}
							DATA.push(Obj)
							NewHtml = NewHtml + '<li class="record">'+
					        		'<div class="mui-row  recordItem">'+
								        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
								            '<span class="orderNo">'+ Item.fnumber +'</span>'+
								        '</div>'+
								        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
								        		'<input type="number" name="acreage" onkeyup="calculateTotals()" value="'+ Item.sqare +'"class="acreage" placeholder="" />'+
								        '</div>'+
								        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
								            '<select name="algorithm" class="algorithm" onchange="changePrice()">'+
								            	GetSelectHtml(CalculateAlgorithmPrice(Item.gongxuId)) +
					                        '</select>'+
								        '</div>'+
								        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
								            '<span class="priceShow">¥'+ CalculateAlgorithmPrice(Item.gongxuId)+'</span>'+
								        '</div>'+
								        '<div class="mui-col-sm-3 mui-col-xs-3 ">'+
								            '¥ <output name="item_total" class="item_total">'+ Item.famount +'</output>'+	
								        '</div>'+
								        '<div class="mui-col-sm-1 mui-col-xs-1 ">'+
								        	'<span class="mui-icon mui-icon-closeempty delete" data-idx=' + Idx + ' onclick="deleteOne(' + Idx + ')"></span>'+
//								        	'<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined delete" data-idx=' + Idx + ' onclick="deleteOne(' + Idx + ')">删</button>'+
//								            '<span class="delete" data-idx=' + Idx + ' onclick="deleteOne(' + Idx + ')">删</span>'+
								        '</div>'+
								    '</div>'+
					        	'</li>'
						})
						$('#content').append(NewHtml)
						
						//员工列表
						data.salary.salaryEmployeeList.map(function(Item,Idx){
							var EmployeeObj = {
								'femployeeName' : Item.femployeeName,
								'id' : Item.id
							}
		            		employeeHtml += '<li class="record">'+
								        		'<div class="mui-row  recordItem">'+
											        '<div class="mui-col-sm-6 mui-col-xs-6 ">'+
											            '<span class="employee_name" data-id='+ Item.id+'>' + (Idx + 1) + '. ' + Item.femployeeName+'</span>'+
											        '</div>'+
											        '<div class="mui-col-sm-6 mui-col-xs-6 ">'+
											        		'<input type="number" name="employee_wage" onkeyup="changeEmployeeWage('+ Idx +')" class="employee_wage" placeholder="" data-idx='+ Idx+' data-price="0" value="'+ Item.famount +'"/>'+
											        '</div>'+
											    '</div>'+
								        	'</li>'
		            	})
						$('#content_employee').append(employeeHtml)

					},'json'
				);
				
				qtyListeners();
			};
			GetGongXu();
			
			var formatMoney = function(value) {
				return value
//		      	return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
		   };
		    
		    var calculateTotals = function(){
		    	var i = 0,
			        ln = algorithmFields.length,
			        temArea = 0,
			        temPrice = 0.00,
			        itemTotal = 0.00,
			        sumTotal = 0.00,
			        sumTotalMoney = 0.00;
				for(;i<ln;i++) {
			        if(!!acreageFields[i].valueAsNumber) {
			          itemArea = acreageFields[i].valueAsNumber || 0;
			          DATA[i].area = acreageFields[i].valueAsNumber || 0;
			        } else {
			          itemArea = parseFloat(acreageFields[i].value) || 0;
			          DATA[i].area = parseFloat(acreageFields[i].value) || 0;
			        }
//			        if(!!acreageFields[i].dataset) {
//			          itemPrice = parseFloat(acreageFields[i].dataset.price);
//			          DATA[i].price = parseFloat(acreageFields[i].dataset.price);
//			        } else {
//			          itemPrice = parseFloat(acreageFields[i].getAttribute('data-price'));
//			          DATA[i].price = parseFloat(acreageFields[i].getAttribute('data-price'));
//			        }
			        itemTotal = itemArea *itemPrice;
			        DATA[i].total = itemArea *itemPrice;
			        itemTotalMoney = formatMoney(itemTotal.toFixed(2));
			        //sumTotal +=itemTotal;
			        //sumTotalMoney = '$'+formatMoney(sumTotal.toFixed(2));
			
			        if(!!totalFields[i].value) {
			          totalFields[i].value =itemTotalMoney;
			          //orderTotalField.value =orderTotalMoney;
			        } else {
			          totalFields[i].innerHTML =itemTotalMoney;
			          //$('.sum')[0].innerHTML =sumTotalMoney;
			          //orderTotalField.innerHTML =orderTotalMoney;
			        }
			    }
		   };
		    
		    //保存
		    save.addEventListener('tap',function(){
		    	var RealArray = []
		    	DATA.map(function(Item,Idx){
		    		if(!Item.del){
		    			RealArray.push(Item)	
		    		}
		 		})
		    	var Data = {
		    		userid:window.localStorage.getItem('userid'),
		    		id: window.localStorage.getItem('recordId'),
		    		GxSalary: $('.sum_T')[0].innerHTML,
		    		EmployeeSalary: $('.sum_B')[0].innerHTML,
		    		fdepartId: window.localStorage.getItem('departmentId'),
					salarySqare: RealArray,
					salaryEmployee: salaryEmployee
		    	}
		    	var ReLogin = function(){
					mui.openWindow({
					    url:'../../index.html',
					    id:'index.html',
					})
				}
				var ConfirmSave = function(){
					if(window.localStorage.getItem('departmentId') && window.localStorage.getItem('recordId') && window.localStorage.getItem('userid')){
						mask.show()
						mui.ajax(Url + 'updateGongXu',{
							data:Data,
							dataType:'json',//服务器返回json格式数据
							type:'post',//HTTP请求类型
							timeout:10000,//超时时间设置为10秒；
							headers:{'Content-Type':'application/json'},	              
							success:function(data){
								switch(data.code){
									case 0:
										mui.toast(data.message,{ duration:'1500', type:'div' })
										mui.back()
										break
									default:
										mask.close()
										mui.toast(data.message,{ duration:'1500', type:'div' })
								}
							},
							error:function(xhr,type,errorThrown){
								//异常处理；
								console.log(type);
							}
						});
					}else{
						mui.alert( '请重新登录!', '提示', function(e){
							ReLogin()
						})
					}
				}
				//权限校验
				if(window.localStorage.getItem('role') != 1){
					if(LimitType != 0 && LimitType !=1){
						mui.alert( '已超过48小时!', '提示')
						return false
					}
					
				}
				//两个合计校验
		    	if($('.sum_T')[0].innerHTML != $('.sum_B')[0].innerHTML){
		    		mui.alert( '两个总计不一致!', '提示')
					return false
		    	}
		    	if(BtIfCanSave){
		    		BtIfCanSave = false
		    		ConfirmSave()
		    	}else{
		    		return false
		    	}
		    });
		    
		    //添加按钮
			addOneWage.addEventListener('tap', function(event) {
				var NewHtml = ''
				NewHtml = NewHtml + '<li class="record">'+
			        		'<div class="mui-row  recordItem">'+
						        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
						            '<span class="orderNo"></span>'+
						        '</div>'+
						        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
						        		'<input type="number" name="acreage" class="acreage" placeholder="面积" data-algorithmid='+ GongxuMathList[0].id +' data-price='+ GongxuMathList[0].gongxu_price + '/>'+
						        '</div>'+
						        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
						            '<select name="algorithm" class="algorithm" onchange="changePrice()">'+
						            	GongXuListHtml +
			                        '</select>'+
						        '</div>'+
						        '<div class="mui-col-sm-2 mui-col-xs-2 ">'+
						            '<span class="priceShow">¥' + parseFloat(GongxuMathList[0].gongxu_price).toFixed(2) +'</span>'+
						        '</div>'+
						        '<div class="mui-col-sm-3 mui-col-xs-3 ">'+
						            '¥<output name="item_total" class="item_total">00.00</output>'+	
						        '</div>'+
						        '<div class="mui-col-sm-1 mui-col-xs-1 ">'+
						        	'<span class="mui-icon mui-icon-closeempty delete" data-idx=' + DATA.length + ' onclick="deleteOne(' + DATA.length + ')"></span>'+
//						        	'<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined delete" data-idx=' + DATA.length + ' onclick="deleteOne(' + DATA.length + ')">删除</button>'+
						            //'<span class="delete" onclick="deleteOne(' + DATA.length + ')" data-idx=' + DATA.length + '>删除 ' +'</span>'+
						        '</div>'+
						    '</div>'+
			        	'</li>'
				$('#content').append(NewHtml)
				AutoOrderNo()
				wageForm = document.forms.wage,
				priceShow = document.getElementsByClassName('priceShow'),
				acreageFields = document.getElementsByClassName('acreage'),
				algorithmFields = document.getElementsByClassName('algorithm'),
		        totalFields = document.getElementsByClassName('item_total'),
		        deleteFields = document.getElementsByClassName('delete');
		        employeeWageFields = document.getElementsByClassName('employee_wage');
		        qtyListeners();
			});
			
		    //更新Summary_T
		    var UpdateSummary_T = function(){
		    	var Summary_T = 0.00
		    	DATA.map(function(Item,Idx){
		    		if(!Item.del){
		    			Summary_T+=	parseFloat(Item.famount)
		    		}
		    	})
		    	$('.sum_T')[0].innerHTML =Summary_T.toFixed(2)
		    	
		    };
		    //更新Summary_B
		    var UpdateSummary_B = function(){
		    	var Summary_B = 0.00
		    	salaryEmployee.map(function(Item,Idx){
		    		if(Item.famount != '' && Item.famount){
		    			Summary_B+=	parseFloat(Item.famount)
		    		}
		    	})
		    	$('.sum_B')[0].innerHTML =Summary_B.toFixed(2)
		    };
		    
		    //修改工序/单价
		    var GetDefaultPrice = function(){
		    	var i = 0,
			        ln = algorithmFields.length;
			    for(;i<ln;i++) {
			    	acreageFields[i].setAttribute('data-price',algorithmFields[i].value)
			    	priceShow[i].innerHTML = '¥ ' + parseFloat(algorithmFields[i].value).toFixed(2)
			    	ChangeAlgorithmId(i,algorithmFields[i].value)
			    }
		    };
		    
		    //修改工序/单价
		    var changePrice = function(){
		    	var i = 0,
			        ln = algorithmFields.length;
			    for(;i<ln;i++) {
			    	acreageFields[i].setAttribute('data-price',algorithmFields[i].value)
			    	priceShow[i].innerHTML = '¥ ' + parseFloat(algorithmFields[i].value)
			    	ChangeAlgorithmId(i,algorithmFields[i].value)
			    }
			    calculateTotals()
		    };
		    
		    var calculateTotals2 = function(){
		    	changePrice()
		    	var i = 0,
			        ln = algorithmFields.length,
			        temArea = 0,
			        temPrice = 0.00,
			        itemTotal = 0.00,
			        sumTotalMoney = 0.00;
				for(;i<ln;i++) {
			        if(!!acreageFields[i].valueAsNumber) {
			          itemArea = acreageFields[i].valueAsNumber || 0;
			          DATA[i].sqare = acreageFields[i].valueAsNumber || 0;
			        } else {
			          itemArea = parseFloat(acreageFields[i].value) || 0;
			          DATA[i].sqare = parseFloat(acreageFields[i].value) || 0;
			        }
			        if(!!acreageFields[i].dataset) {
			          itemPrice = parseFloat(acreageFields[i].dataset.price);
			          DATA[i].gongxuId = acreageFields[i].dataset.algorithmid;
			          DATA[i].price = parseFloat(acreageFields[i].dataset.price);
			        } else {
			          itemPrice = parseFloat(acreageFields[i].getAttribute('data-price'));
			          DATA[i].gongxuId = acreageFields[i].getAttribute('data-algorithmid');
			          DATA[i].price = parseFloat(acreageFields[i].getAttribute('data-price'));
			        }
			        itemTotal = itemArea *itemPrice;
			        DATA[i].famount = itemArea *itemPrice;
			        itemTotalMoney = formatMoney(itemTotal.toFixed(2));
			
			        if(!!totalFields[i].value) {
			          totalFields[i].value =itemTotalMoney;
			        } else {
			          totalFields[i].innerHTML =itemTotalMoney;
			        }
			    }
				UpdateSummary_T()
		    };
		    
		    //计算具体金额
		    var calculateTotals = function(){
		    	GetDefaultPrice()
		    	var i = 0,
			        ln = algorithmFields.length,
			        temArea = 0,
			        temPrice = 0.00,
			        itemTotal = 0.00,
//			        sumTotal = 0.00,
			        sumTotalMoney = 0.00;
				for(;i<ln;i++) {
			        if(!!acreageFields[i].valueAsNumber) {
			          itemArea = acreageFields[i].valueAsNumber || 0;
			          DATA[i].sqare = acreageFields[i].valueAsNumber || 0;
			        } else {
			          itemArea = parseFloat(acreageFields[i].value) || 0;
			          DATA[i].sqare = parseFloat(acreageFields[i].value) || 0;
			        }
			        if(!!acreageFields[i].dataset) {
			          itemPrice = parseFloat(acreageFields[i].dataset.price);
			          DATA[i].gongxuId = acreageFields[i].dataset.algorithmid;
			          DATA[i].price = parseFloat(acreageFields[i].dataset.price);
			        } else {
			          itemPrice = parseFloat(acreageFields[i].getAttribute('data-price'));
			          DATA[i].gongxuId = acreageFields[i].getAttribute('data-algorithmid');
			          DATA[i].price = parseFloat(acreageFields[i].getAttribute('data-price'));
			        }
			        itemTotal = itemArea *itemPrice;
			        DATA[i].famount = itemArea *itemPrice;
			        itemTotalMoney = formatMoney(itemTotal.toFixed(2));
//			        sumTotal +=itemTotal;
//			        sumTotalMoney = '$'+formatMoney(sumTotal.toFixed(2));
			
			        if(!!totalFields[i].value) {
			          totalFields[i].value =itemTotalMoney;
			          //$('.sum')[0].innerHTML =sumTotalMoney;
			        } else {
			          totalFields[i].innerHTML =itemTotalMoney;
			          //$('.sum')[0].innerHTML =sumTotalMoney;
			        }
			    }
				UpdateSummary_T()
		    };
		    
		    //记录工序id
		    var ChangeAlgorithmId =  function(Index,Price){
		    	GongxuMathList.map(function(Item,Idx){
		    		if(Item.gongxu_price == Price){
		    			acreageFields[Index].setAttribute('data-algorithmid',Item.id);
		    		}
		    	})
		    };
		    
		    //自动生成单号
		    var AutoOrderNo = function(){
		    	var IDX = DATA.length;
		    	var n = '0000' + IDX;
  				n = n.substr(n.length-5,5);
				var Obj = {}
				Obj.fnumber = '' + n,
				Obj.sqare = '',
				Obj.price = 0.00,
				Obj.famount = 0.00,
				Obj.gongxuId = GongxuMathList[0].id
				Obj.del = false
				DATA.push(Obj)
				$('.orderNo')[IDX].innerHTML = '' + n
				console.log(DATA)
		    };
		    
		    //删除一条
		    var deleteOne = function(IDX){
		    	var DelIDX = IDX 
		    	$('.record').eq(DelIDX).hide()
		    	DATA[DelIDX].del = true
		    	UpdateSummary_T()
		    };
		    
		    //填写员工工资
		    var changeEmployeeWage = function(IDX){
		    	salaryEmployee[IDX].famount = parseFloat(employeeWageFields[IDX].value)
		    	UpdateSummary_B()
		    };
		    
		    //查询修改日志
		    var LookLog = function(){
		    	mui.openWindow({
				    url:'../log/index.html',
				    id:'log/ndex.html',
				})
		    };
		</script>
	</body>

</html>