<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>记录列表</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="../../js/jquery-3.3.1.min.js"></script>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/style.css" rel="stylesheet" />
		<style>
			#refreshContainer{
				margin-bottom: 50px;
			}
			.RecordList{
				font-size: 14px;
			}
			.mui-table-view-chevron .mui-table-view-cell{
				padding-right:15px ;
			}
			/*.mui-table-view{
				background: transparent !important;
			}*/
			.mui-table-view:before{
				height: 0 !important;
			}
			.mui-table-view:after{
				height: 0 !important;
			}
		</style>
	</head>

	<body>
		<!--下拉刷新容器-->
		<div id="refreshContainer" class="mui-content mui-scroll-wrapper">
		  <div class="mui-scroll">
		    <!--数据列表-->
		    <ul class="mui-table-view mui-table-view-chevron RecordList">
			    
		    </ul>
		  </div>
		</div>
		
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init()
			var Url = 'http://220.248.107.62:8086/gxJK/'
//			var Url = 'http://http://205.168.1.112:8082/'
			var SalaryList = []
			var formatTime = function(date) {
				var year = date.getFullYear()
				var month = date.getMonth() + 1
				var day = date.getDate()
				
				var hour = date.getHours()
				var minute = date.getMinutes()
				var second = date.getSeconds()
				
				return [year, month, day].map(formatNumber).join('-') + '/' + [hour, minute, second].map(formatNumber).join(':')
			}
			var formatNumber = function(n) {
				n = n.toString()
				return n[1] ? n : '0' + n
			}
			var ReLogin = function(){
				mui.openWindow({
				    url:'../../index.html',
				    id:'index.html',
				})
			}
			var GetRecordList = function(){
				if(window.localStorage.getItem('departmentId')){
					var RecordListHtml = ''
					mui.get(Url + 'gongxuList',{'fdepartId': window.localStorage.getItem('departmentId')},function(data){
							SalaryList = data.salaryList
							if(data.salaryList.length <= 0){
								RecordListHtml = '<h4 class="emptyList">暂无记录</h4>'
							}else{
								data.salaryList.map(function(Item,Idx){
			            		RecordListHtml += '<li class="mui-table-view-cell" onclick="ToModifyRecord( '+ Idx +')" data-id='+ Item.id +'>'+
					            		'<div class="mui-row  recordItem">'+
									        '<div class="mui-col-sm-8 mui-col-xs-8 ">'+
									            '<span>'+ (Idx + 1) + '.  ' + formatTime(new Date(Item.fdate.time)) +'</span>'+
									        '</div>'+
									        '<div class="mui-col-sm-4 mui-col-xs-4 TextAlign_Right">'+
									        	'<span>'+ Item.departname +'</span>'+
									        '</div>'+
									    '</div>'+
				            		'</li>'
				            	})
							}
							$('.RecordList').append(RecordListHtml)
						},'json'
					);
				}else{
					mui.alert( '请重新登录!', '提示', function(e){
						ReLogin()
					})
				}
			}
			GetRecordList()
			//去修改记录
			var ToModifyRecord = function(IDX){
				window.localStorage.setItem('recordId',SalaryList[IDX].id);
				window.localStorage.setItem('recordDate',(formatTime(new Date(SalaryList[IDX].fdate.time))).substr(0,10));
					mui.openWindow({
					    url:'../detail/index.html',
					    id:'detail/index.html',
					    styles:{
					     
					    },
					    extras:{
					    },
					    createNew:false,
					    show:{
					      autoShow:true,
					    },
					    waiting:{
					      autoShow:true,
					      title:'正在加载...',
					      options:{
					      	
					      }
					    }
					})
			}
			
//			mui.init({
//			  pullRefresh : {
//			    container:"#refreshContainer",
//			    down : {
//			    	style:'circle',
//			    	callback :pulldownRefresh 
//			    }
//			  }
//			});
//			/**
//			 * 下拉刷新具体业务实现
//			 */
//			function pulldownRefresh() {
//				setTimeout(function() {
//					mui('#refreshContainer').pullRefresh().endPulldownToRefresh();
//					mui.toast("刷新完毕");
//				}, 1500);
//			}
		</script>
	</body>

</html>