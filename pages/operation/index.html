<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>工序流转</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/style.css" rel="stylesheet" />
		<style>
			html , body{
				background: #fff;
			}
			.mui-popup{
				position:fixed !important;
			}
			.FloatRight{
	            float: right;
	            color: #dd524d;
	            font-weight: bold;
	        }
	        .mui-content{
	            background: #fff !important;
	        }
	        .TextAlign_left{
	            text-align: left;
	        }
	        .Margin_10{
	            margin: 10px;
	        }
	        .ColumnBar{
	            padding-top: 10px;
	            padding-bottom: 10px;
	            border-top: 0px solid #efefef;
	            border-bottom: 0px solid #efefef;
	            font-size: 12px;
	            font-weight: bold;
	            text-align: center;
	        }
	        .ColumnBar_Top{
	            padding:10px;
	            border-top: 0px solid #efefef;
	            border-bottom: 0px solid #efefef;
	            font-size: 12px;
	            font-weight: bold;
	            text-align: left;
	        }
	        select{
	            width: auto !important;
	        }
	        .ColumnBar_B{
	            padding-top: 10px;
	            padding-bottom: 10px;
	            border-top: 0px solid #efefef;
	            border-bottom: 1px solid #efefef;
	            font-size: 12px;
	            font-weight: bold;
	            text-align: center;
	        }
	        .employee_wage{
	            text-align: center !important;
	        }
	        input{
	            width: 100%;
	            padding: 0 !important;
	            font-size: 12px;
	            border-radius: 0 !important;
	            border: 0px !important;
	            border-bottom: 1px solid #333 !important;
	        }
	        .ColumnBar input{
	            text-align: center !important;
	        }
	        select{
	            width: 100%;
	            font-size: 12px;
	            padding: 0;
	            margin-top: 0;
	            -webkit-appearance: menulist;
	            box-sizing: border-box;
	            align-items: center;
	            white-space: pre;
	            -webkit-rtl-ordering: logical;
	            color: black;
	            background-color: white;
	            cursor: default;
	            border-width: 1px;
	            border-style: solid;
	            border-color: initial;
	            border-image: initial;
	        }
	        .recordItem{
	            padding: 0 10px;
	            height: 40px;
	            line-height: 40px;
	            font-size: 12px;
	            font-weight: normal;
	        }
	        .record{
	            width: 100%;
	            display: block;
	            overflow: hidden;
	        }
	        .content_employee .record{
	            padding: 0 8px;
	
	        }
	        .mui-table-view:before{
	            height: 0px;
	        }
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">工序流转</h1>
		</header>
		<div class="mui-content">
		    <div class="mui-row ColumnBar">
		        <div class="mui-col-sm-4 mui-col-xs-3 ">
		            订单号
		        </div>
		        <div class="mui-col-sm-4 mui-col-xs-3 ">
		            描述
		        </div>
		        <div class="mui-col-sm-4 mui-col-xs-4 ">
		            数量
		        </div>
		
		    </div>
		
		    <div class="mui-row ColumnBar_Top">
		        <div class="mui-col-sm-4 mui-col-xs-4 ">
		            <span id="orderId"></span>
		        </div>
		        <div class="mui-col-sm-4 mui-col-xs-4 ">
		            <span id="remark"></span>
		        </div>
		        <div class="mui-col-sm-4 mui-col-xs-4" >
		            <span id="orderNumber"></span>
		        </div>
		
		    </div>
		    <div class="mui-row">
		        <ul class="mui-table-view">
		            <li>
		                <div class="mui-row  recordItem TextAlign_Left">
		                    <div class="mui-col-sm-6 mui-col-xs-6 ">
		                    </div>
		                </div>
		            </li>
		        </ul>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            压贴开工日期：<span id="yt_begin_time"></span>
		        </div>
		
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            压贴完工日期：<span id="yt_end_time"></span>
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            成型一组开工日期：<span id="cx_begin_time"></span>
		        </div>
		
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            成型一组完工日期：<span id="cx_end_time"></span>
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            成型二组开工日期：<span id="cx2_begin_time"></span>
		        </div>
		
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            成型二组完工日期：<span id="cx2_end_time"></span>
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            木工开工日期：<span id="mg_begin_time"></span>
		        </div>
		
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            木工完工日期：<span id="mg_end_time"></span>
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            油漆开工日期：<span id="yq_begin_time"></span>
		        </div>
		
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            油漆完工日期：<span id="yq_end_time"></span>
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            包装开工日期：<span id="bz_begin_time"></span>
		        </div>
		
		        <div class="mui-col-sm-6 mui-col-xs-6 ">
		            包装完工日期：<span id="bz_end_time"></span>
		        </div>
		    </div>
		    <div class="mui-row">
		        <ul class="mui-table-view">
		            <li>
		                <div class="mui-row  recordItem TextAlign_Left">
		                    <div class="mui-col-sm-6 mui-col-xs-6 ">
		                        <span>详情</span>
		                    </div>
		
		                </div>
		            </li>
		        </ul>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		            状态
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 ">
		            工序
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-3 ">
		            数量
		        </div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            开工日期
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 "></div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            完工日期
		        </div>
		
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		            <span id="yatie-status-txt" hidden></span>
		            <img id="yatie-status"/>
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 ">
		            压贴
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="yatie_forder" hidden></span>
		            <span id="yatie" hidden></span>
		            <button class="mui-btn mui-btn-outlined mui-btn-primary" style="display: none;width: 90%;padding: 6px 2px;" onclick="inputNum(this,'压贴')">扫码</button>
		            <span></span>
		        </div>
		        <div class="mui-col-sm-3 mui-col-xs-3 " >
		            <input id="yatie-startTime" type="text" disabled placeholder="开工日期">
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 "></div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="yatie-endTime" type="text" disabled placeholder="完工日期">
		        </div>
		
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-2 mui-col-xs-2">
		        	<span id="chengxing-status-txt" hidden></span>
		            <img id="chengxing-status"/>
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 ">
		            成型一组
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="chengxing_forder" hidden></span>
		            <span id="chengxing" hidden></span>
		            <button class="mui-btn mui-btn-outlined  mui-btn-primary" style="display: none;width: 90%;padding: 6px 2px;" onclick="inputNum(this,'成型车间一组')">扫码</button>
		            <span></span>
		        </div>
		
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="chengxing-startTime" type="text" disabled placeholder="开工日期">
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 "></div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="chengxing-endTime" type="text" disabled placeholder="完工日期">
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="chengxing2-status-txt" hidden></span>
		            <img id="chengxing2-status"/>
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 ">
		            成型二组
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="chengxing2_forder" hidden></span>
		            <span id="chengxing2" hidden></span>
		            <button class="mui-btn mui-btn-outlined  mui-btn-primary" style="display: none;width: 90%;padding: 6px 2px;" onclick="inputNum(this,'成型车间二组')">扫码</button>
		            <span></span>
		        </div>
		
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="chengxing2-startTime" type="text" disabled placeholder="开工日期">
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 "></div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="chengxing2-endTime" type="text" disabled placeholder="完工日期">
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="mugong-status-txt" hidden></span>
		            <img id="mugong-status"/>
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 ">
		            木工
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="mugong_forder" hidden></span>
		            <span id="mugong" hidden></span>
		            <button class="mui-btn mui-btn-outlined mui-btn-primary" style="display: none;width: 90%;padding: 6px 2px;" onclick="inputNum(this,'木工')">扫码</button>
		            <span></span>
		        </div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="mugong-startTime" type="text" disabled placeholder="开工日期">
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 "></div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="mugong-endTime" type="text" disabled placeholder="完工日期">
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="youqi-status-txt" hidden></span>
		            <img id="youqi-status"/>
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 ">
		            油漆
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="youqi_forder" hidden></span>
		            <span id="youqi" hidden></span>
		            <button class="mui-btn mui-btn-outlined mui-btn-primary" style="display: none;width: 90%;padding: 6px 2px;" onclick="inputNum(this,'油漆')">扫码</button>
		            <span></span>
		        </div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="youqi-startTime" type="text" disabled placeholder="开工日期">
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 "></div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="youqi-endTime" type="text" disabled placeholder="完工日期">
		        </div>
		    </div>
		    <div class="mui-row ColumnBar Margin_T0">
		        <div class="mui-col-sm-2 mui-col-xs-2 ">
		        	<span id="baozhuang-status-txt" hidden></span>
		        	<img id="baozhuang-status"/>
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 ">
		            包装
		        </div>
		        <div class="mui-col-sm-2 mui-col-xs-2">
		        	<span id="baozhuang_forder" hidden></span>
		            <span id="baozhuang" hidden></span>
		            <button class="mui-btn mui-btn-outlined mui-btn-primary" style="display: none;width: 90%;padding: 6px 2px;" onclick="inputNum(this,'包装')">扫码</button>
		            <span></span>
		        </div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="baozhuang-startTime" type="text" disabled placeholder="开工日期">
		        </div>
		        <div class="mui-col-sm-1 mui-col-xs-1 "></div>
		        <div class="mui-col-sm-3 mui-col-xs-3 ">
		            <input id="baozhuang-endTime" type="text" disabled placeholder="完工日期">
		        </div>
		
		    </div>
		
		    <button class="mui-btn mui-btn-block  mui-btn-primary" style="display: none;" id="btnOpenWork"  onclick="openWork(this)">开工</button>
		</div>


		
		<script src="../../js/mui.min.js"></script>
    	<script src="../../js/jquery-3.3.1.min.js"></script>
    	<script src="../../js/utils.js"></script>
    	<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
		<script type="text/javascript">
			var cuurDept = 6;
		    // 压贴
		    var yatie = "8a8a8aa863b038a00163b143e2ac0006";
		    //成型
		    var chengxu = "8a8a8aa863b038a00163b14684470010";
		    var chengxing = '8a8a8aa863b708ad0163b8f7d3130011';
		    var chengxing2 = '8a8a8aa863b708ad0163b8f9ed5e0014';
		    //木工
		    var mugong = "8a8a8aa863b038a00163b146e9b30012";
		    //油漆
		    var youqi = "8a8a8aa863b038a00163b14728a90014";
		    //包装
		    var baozhuang = "8a8a8aa863b9ebbc0163bb713304021d";
		    
		    var AccessToken = '';
		    
		    var departmentId;
		    
		    function ConfigFn(JsapiTicket){
				var mytimestamp = (Date.parse(new Date())) / 1000;
				var mynonceStr = sha1.hash(String(mytimestamp)).substring(0, 16);
				var mysignature = "jsapi_ticket=" + JsapiTicket + "&noncestr=" + mynonceStr + "&timestamp=" + mytimestamp + "&url=" + window.parent.location.href.split("#")[0];
			
				wx.config({
				    beta: true,
				    debug: false, 
				    appId: 'wwa4949071417f1baf', 
				    timestamp: mytimestamp, 
				    nonceStr: mynonceStr, 
				    signature: sha1.hash(mysignature),
				    jsApiList: [
				    	'scanQRCode',
				    	'chooseImage'
				    ]
				});
				wx.error(function(res){
					console.log('config失败---')
				    // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
				});
				wx.ready(function(){
				    // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
				});
			};
			
		    function GetJsapiTicket(ACCESS_TOKEN){
				mui.get('http://www.btzoon.com:8080/gxJK/getJSApiTicket?yxName=工序',{},function(res){
						ConfigFn(res.ticket)
					},'json'
				);
			};
			
		    $(function () {
		        if(!window.localStorage.getItem('departmentId')){
		            mui.alert( '请重新登录!', '提示', function(e){
		
		            })
		        }
		        mui.get(Url + 'getAccessToken',{yxName:'工序'},function(res){
					AccessToken = res.accessToken
					},'json'
				);
				//页面config配置
				GetJsapiTicket()
				//获取图标
		
		        var departmentId = window.localStorage.getItem('departmentId');
		        var orderDetailData =JSON.parse(window.localStorage.getItem('orderDetail'));
		
		        $("#orderId").text(orderDetailData.order_no);
		        $("#remark").text(orderDetailData.order_describe);
		        $("#orderNumber").text(orderDetailData.fnumber);
		
		        $("#yt_begin_time").text(formatDateTime(orderDetailData.yt_begin_time.time));
		        $("#yt_end_time").text(formatDateTime(orderDetailData.yt_end_time.time));
		        $("#cx_begin_time").text(formatDateTime(orderDetailData.cx_begin_time.time));
		        $("#cx_end_time").text(formatDateTime(orderDetailData.cx_end_time.time));
		        $("#cx2_begin_time").text(formatDateTime(orderDetailData.cx2_begin_time.time));
		        $("#cx2_end_time").text(formatDateTime(orderDetailData.cx2_end_time.time));
		        $("#mg_begin_time").text(formatDateTime(orderDetailData.mg_begin_time.time));
		        $("#mg_end_time").text(formatDateTime(orderDetailData.mg_end_time.time));
		        $("#yq_begin_time").text(formatDateTime(orderDetailData.yq_begin_time.time));
		        $("#yq_end_time").text(formatDateTime(orderDetailData.yq_end_time.time));
		        $("#bz_begin_time").text(formatDateTime(orderDetailData.bz_begin_time.time));
		        $("#bz_end_time").text(formatDateTime(orderDetailData.bz_end_time.time));
		
		
		        mui.get(Url + 'orderDetail?order_no='+orderDetailData.order_no,{},function(data){
		                if(departmentId==yatie || departmentId==baozhuang){
		                    $("#btnOpenWork").show();
		                }
		                $.each(data.orderDetail,function(i,data){
		                if(!data.fstatus){
		                    data.fstatus = 0;
		                }
		                if(data.gongxu=="压贴"){
		                	$("#yatie_forder").html(data.forder);
		                    $("#yatie").html(data.id);
		                    $('#yatie-status-txt').text(getStatus(data.fstatus))
		                    $("#yatie-status").attr('src',getStatusIcon(data.fstatus))
		                    if(data.fstatus==0){
		                        $("#btnOpenWork").html("开工");
		                    }else{
		                        $("#btnOpenWork").html("已开工");
		                    }
		                    if(data.fnumber>0){
		                        $("#yatie").next().hide();
		                        $("#yatie").next().next().text(data.fnumber);
		                    }
		                    if(data.ftime){
		                        $("#yatie-startTime").val(formatDateTime(data.ftime.time));
		                    }
		                    if(data.fendtime){
		                        $("#yatie-endTime").val(formatDateTime(data.fendtime.time));
		                    }
		
		                }else if(data.gongxu=="成型一组"){
		                	$("#chengxing_forder").html(data.forder);
		                    $("#chengxing").html(data.id);
		                    $('#chengxing-status-txt').text(getStatus(data.fstatus))
		                    $("#chengxing-status").attr('src',getStatusIcon(data.fstatus))
		                    if(data.fnumber>0){
		                        $("#chengxing").next().hide();
		                        $("#chengxing").next().next().text(data.fnumber);
		                    }
		                    if(data.ftime){
		                        $("#chengxing-startTime").val(formatDateTime(data.ftime.time));
		                    }
		                    if(data.fendtime){
		                        $("#chengxing-endTime").val(formatDateTime(data.fendtime.time));
		                    }
		
		                }else if(data.gongxu=="成型二组"){
		                	$("#chengxing2_forder").html(data.forder);
		                    $("#chengxing2").html(data.id);
		                    $('#chengxing2-status-txt').text(getStatus(data.fstatus));
		                    $("#chengxing2-status").attr('src',getStatusIcon(data.fstatus));
		                    if(data.fnumber>0){
		                        $("#chengxing2").next().hide();
		                        $("#chengxing2").next().next().text(data.fnumber);
		                    }
		                    if(data.ftime){
		                        $("#chengxing2-startTime").val(formatDateTime(data.ftime.time));
		                    }
		                    if(data.fendtime){
		                        $("#chengxing2-endTime").val(formatDateTime(data.fendtime.time));
		                    }
		
		                }else if(data.gongxu=="木工"){
		                	$("#mugong_forder").html(data.forder);
		                    $("#mugong").html(data.id);
		                    $('#mugong-status-txt').text(getStatus(data.fstatus));
		                    $("#mugong-status").attr('src',getStatusIcon(data.fstatus));
		                    if(data.fnumber>0){
		                        $("#mugong").next().hide();
		                        $("#mugong").next().next().text(data.fnumber);
		                    }
		                    if(data.ftime){
		                        $("#mugong-startTime").val(formatDateTime(data.ftime.time));
		                    }
		                    if(data.fendtime){
		                        $("#mugong-endTime").val(formatDateTime(data.fendtime.time));
		                    }
		                }else if(data.gongxu=="油漆"){
		                	$("#youqi_forder").html(data.forder);
		                    $("#youqi").html(data.id);
		                    $('#youqi-status-txt').text(getStatus(data.fstatus));
		                    $("#youqi-status").attr('src',getStatusIcon(data.fstatus));
		                    if(data.fnumber>0){
		                        $("#youqi").next().hide();
		                        $("#youqi").next().next().text(data.fnumber);
		                    }
		                    if(data.ftime){
		                        $("#youqi-startTime").val(formatDateTime(data.ftime.time));
		                    }
		                    if(data.fendtime){
		                        $("#youqi-endTime").val(formatDateTime(data.fendtime.time));
		                    }
		
		                }else if(data.gongxu=="包装"){
		                	$("#baozhuang_forder").html(data.forder);
		                    $("#baozhuang").html(data.id);
		                    $('#baozhuang-status-txt').text(getStatus(data.fstatus));
		                    $("#baozhuang-status").attr('src',getStatusIcon(data.fstatus));
		                    if(data.fnumber>0){
		                        $("#baozhuang").next().hide();
		                        $("#baozhuang").next().next().text(data.fnumber);
		                    }
		                    if(data.ftime){
		                        $("#baozhuang-startTime").val(formatDateTime(data.ftime.time));
		                    }
		                    if(data.fendtime){
		                        $("#baozhuang-endTime").val(formatDateTime(data.fendtime.time));
		                    }
		                    if(data.fstatus==1){
		                        $("#btnOpenWork").html("完工");
		                    }else if(data.fstatus==2){
		                        $("#btnOpenWork").html("已完成");
		                    }
		                }
		            });
		            showNumberButton();
		        },'json');
		    });
		
		    function showNumberButton(){
		        var departmentId = window.localStorage.getItem('departmentId');
		        if(departmentId==chengxu){
		            if($("#yatie-status-txt").text()=="开工"){
		                $("#yatie").next().show();
		            }
		        }else if(departmentId==chengxing){
		            if($("#yatie-status-txt").text()=="开工"){
		                $("#yatie").next().show();
		            }
		        }else if(departmentId==chengxing2){
		            if($("#chengxing-status-txt").text()=="开工"){
		                $("#chengxing").next().show();
		            }
		        }else if(departmentId==mugong){
		            if($("#chengxing2-status-txt").text()=="开工"){
		                $("#chengxing2").next().show();
		            }
		        }else if(departmentId==youqi){
		            if($("#mugong-status-txt").text()=="开工"){
		                $("#mugong").next().show();
		            }
		        }else if(departmentId==baozhuang){
		            if($("#youqi-status-txt").text()=="开工"){
		                $("#youqi").next().show();
		            }
		        }
		    }
		
		    function inputNum(ele,name) {
		    	
		    	wx.scanQRCode({
				    desc: 'scanQRCode desc',
				    needResult: 1, 
				    scanType: ["qrCode", "barCode"], 
				    success: function(res) {
				        // res.resultStr 扫描结果
				        mui.confirm('扫描结果1：' + res.resultStr ,'提示',function(e){
							if (e.index == 1) {
								var nowTime = new Date();
					            var orderDetailData =JSON.parse(window.localStorage.getItem('orderDetail'));
					            if(name=="压贴"){
					                var status = nowTime.getTime()>orderDetailData.yt_end_time.time?3:2;
					                updateDetail($(ele).prev().prev().text(),$(ele).prev().text(),res.resultStr,status);
					                updateOpenWork($("#chengxing").text(),1);
					            }else if(name=="成型车间一组"){
					                var status = nowTime.getTime()>orderDetailData.cx_end_time.time?3:2;
					                updateDetail($(ele).prev().prev().text(),$(ele).prev().text(),res.resultStr,status);
					                updateOpenWork($("#chengxing2").text(),1);
					            }else if(name=="成型车间二组"){
					                var status = nowTime.getTime()>orderDetailData.cx2_end_time.time?3:2;
					                updateDetail($(ele).prev().prev().text(),$(ele).prev().text(),res.resultStr,status);
					                updateOpenWork($("#mugong").text(),1);
					            }else if(name=="木工"){
					                var status = nowTime.getTime()>orderDetailData.mg_end_time.time?3:2;
					                updateDetail($(ele).prev().prev().text(),$(ele).prev().text(),res.resultStr,status);
					                updateOpenWork($("#youqi").text(),1);
					            }else if(name=="油漆"){
					                var status = nowTime.getTime()>orderDetailData.yq_end_time.time?3:2;
					                updateDetail($(ele).prev().prev().text(),$(ele).prev().text(),res.resultStr,status);
					                updateOpenWork($("#baozhuang").text(),1);
					            }else if(name=="包装"){
					                var status = nowTime.getTime()>orderDetailData.bz_end_time.time?3:2;
					                updateDetail($(ele).prev().prev().text(),$(ele).prev().text(),res.resultStr,status);
					                updateOpenWork($("#baozhuang").text(),1);
					            }
		                   	}
							if (e.index == 0) {
		                   }
						})
				    },
				    error: function(res) {
				        if (res.errMsg.indexOf('function_not_exist') > 0) {
				            alert('版本过低请升级')
				        }else{
				        	alert('扫描失败！')
				        }
				    }
				});
		    }
		    //
		    function openWork(ele) {
		        var departmentId = window.localStorage.getItem('departmentId');
		        if(departmentId==yatie){
		            if("开工"==$(ele).html()){
		                updateOpenWork($("#yatie_forder").text(),$("#yatie").text(),1);
		                $(ele).html("已开工");
		            }
		        }else if(departmentId==baozhuang){
		            if("完工"==$(ele).html()){
		                var nowTime = new Date();
		                var orderDetailData =JSON.parse(window.localStorage.getItem('orderDetail'));
		                var status = nowTime.getTime()>orderDetailData.bz_end_time.time?3:2;
		                updateDetail($("#baozhuang").text(),$("#youqi").next().next().text(),status);
		                $(ele).html("已完工");
		            }
		        }
		    }
		
		    function updateDetail(Forder,id,fnumber,fstatus){
		        mui.get(Url + 'updateOrderDeatail',{order_no:JSON.parse(window.localStorage.getItem('orderDetail')).order_no,forder:Forder,yxName:'工序',acess_token:AccessToken,userid:window.localStorage.getItem('userid'),id:id,fnumber:fnumber,fstatus:fstatus},function(data){
		            location.reload();
		        },'json');
		    }
		    //开工
		    function updateOpenWork(Forder,id,fstatus){
		        mui.get(Url + 'updateOrderDeatail',{order_no:JSON.parse(window.localStorage.getItem('orderDetail')).order_no,forder:Forder,yxName:'工序',acess_token:AccessToken,userid:window.localStorage.getItem('userid'),id:id,fstatus:fstatus},function(data){
		            location.reload();
		        },'json');
		    }
		
		    function getStatusIcon(i) {
		    	var Icons = JSON.parse(window.localStorage.getItem('Icons'))
		            if(i==0){
			            return Icons[0];
			        }else if(i==1){
			            return Icons[1];
			        }else if(i==2){
			            return Icons[2];
			        }else if(i==3){
			            return Icons[3];
			        }
		    }
		    function getStatus(i) {
		        if(i==0){
		            return "未开工";
		        }else if(i==1){
		            return "开工";
		        }else if(i==2){
		            return "完成";
		        }else if(i==3){
		            return "延期";
		        }
		    }
		
		    function formatDateTime(inputTime) {
		        var date = new Date(inputTime);
		        var y = date.getFullYear();
		        var m = date.getMonth() + 1;
		        m = m < 10 ? ('0' + m) : m;
		        var d = date.getDate();
		        d = d < 10 ? ('0' + d) : d;
		        var h = date.getHours();
		        h = h < 10 ? ('0' + h) : h;
		        var minute = date.getMinutes();
		        var second = date.getSeconds();
		        minute = minute < 10 ? ('0' + minute) : minute;
		        second = second < 10 ? ('0' + second) : second;
		        return y + '-' + m + '-' + d  //+" "+h+":"+minute;
		    };
		</script>
	</body>

</html>